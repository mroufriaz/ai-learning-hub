{% extends 'base.html' %}
{% load static %}
{% block sidebar_title %} Quiz {% endblock sidebar_title %}


{% block content %}

 <!-- Start Screen -->
  <div class="quiz-container" id="quiz-start">
    <div class="quiz-box text-center shadow">
      <h1 class="quiz-title mb-3"><i class="fa-solid fa-brain me-2"></i>Welcome to the Quiz</h1>
      <p class="text-muted mb-4">You have <strong>2 minutes</strong> to complete all 10 questions. Ready?</p>
      <button id="startQuizBtn" class="btn btn-gradient px-5 py-2 rounded-pill">Start Quiz</button>
    </div>
  </div>

  <!-- Quiz Area -->
  <div class="quiz-container d-none" id="quiz-container">
    <div class="quiz-header d-flex justify-content-between align-items-center mb-3">
      <h4 class="fw-bold text-gradient"><i class="fa-solid fa-lightbulb me-2"></i>Quiz Time</h4>
      <div class="quiz-timer"><i class="fa-solid fa-clock me-1"></i><span id="timer">02:00</span></div>
    </div>

    <div class="progress mb-4">
      <div class="progress-bar progress-bar-striped progress-bar-animated" id="progressBar"></div>
    </div>

    <div class="quiz-question-box">
      <h5 id="question" class="fw-semibold mb-3"></h5>
      <div id="answer-buttons" class="answer-options"></div>
    </div>

    <div class="quiz-footer mt-4 d-flex justify-content-between align-items-center">
      <div class="fw-semibold">Score: <span id="score">0</span></div>
      <button id="next-btn" class="btn btn-gradient rounded-pill px-4">Next</button>
    </div>
  </div>

  <!-- Result Section -->
  <div class="quiz-result-screen d-none text-center" id="result-screen">
    <div class="result-box shadow">
      <i class="fa-solid fa-trophy fs-1 text-gradient mb-3"></i>
      <h2 class="fw-bold">Quiz Completed!</h2>
      <p id="finalScore" class="mt-2 text-muted fs-5"></p>
      <button id="restartBtn" class="btn btn-gradient rounded-pill px-5 py-2 mt-3">Restart</button>
    </div>
  </div>


  {% block extra_css %}
    <link rel="stylesheet" href="{% static 'quiz.css' %}">
  {% endblock extra_css %}



{% endblock content %}


{% block scripts %}

<script>
    const questions = [
  { question: "Which language runs in a web browser?", answers: [
      { text: "Python", correct: false },
      { text: "JavaScript", correct: true },
      { text: "C++", correct: false },
      { text: "Java", correct: false }
  ]},
  { question: "What does HTML stand for?", answers: [
      { text: "Hyper Text Markup Language", correct: true },
      { text: "Home Tool Markup Language", correct: false },
      { text: "Hyperlinks and Text Markup Language", correct: false },
      { text: "Hyper Tool Multi Language", correct: false }
  ]},
  { question: "What does CSS control?", answers: [
      { text: "Database", correct: false },
      { text: "Web Page Styling", correct: true },
      { text: "Server Logic", correct: false },
      { text: "Networking", correct: false }
  ]}
];

const startQuizBtn = document.getElementById("startQuizBtn");
const quizContainer = document.getElementById("quiz-container");
const resultScreen = document.getElementById("result-screen");
const startScreen = document.getElementById("quiz-start");
const nextBtn = document.getElementById("next-btn");
const restartBtn = document.getElementById("restartBtn");
const questionElement = document.getElementById("question");
const answerButtons = document.getElementById("answer-buttons");
const progressBar = document.getElementById("progressBar");
const scoreText = document.getElementById("score");
const finalScore = document.getElementById("finalScore");
const timerDisplay = document.getElementById("timer");

let currentQuestionIndex = 0;
let score = 0;
let timerInterval;
let timeLeft = 120; // 2 minutes

startQuizBtn.addEventListener("click", startQuiz);

function startQuiz() {
  startScreen.classList.add("d-none");
  quizContainer.classList.remove("d-none");
  currentQuestionIndex = 0;
  score = 0;
  timeLeft = 120;
  startTimer();
  showQuestion();
}

function startTimer() {
  timerInterval = setInterval(() => {
    timeLeft--;
    const mins = String(Math.floor(timeLeft / 60)).padStart(2, '0');
    const secs = String(timeLeft % 60).padStart(2, '0');
    timerDisplay.textContent = `${mins}:${secs}`;

    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      endQuiz(true); // true = time ran out
    }
  }, 1000);
}

function showQuestion() {
  resetState();
  const current = questions[currentQuestionIndex];
  questionElement.textContent = current.question;
  current.answers.forEach(a => {
    const button = document.createElement("button");
    button.textContent = a.text;
    button.classList.add("answer-btn");
    if (a.correct) button.dataset.correct = true;
    button.addEventListener("click", selectAnswer);
    answerButtons.appendChild(button);
  });
  progressBar.style.width = `${((currentQuestionIndex + 1) / questions.length) * 100}%`;
}

function resetState() {
  nextBtn.style.display = "none";
  answerButtons.innerHTML = "";
}

function selectAnswer(e) {
  const selected = e.target;
  const correct = selected.dataset.correct === "true";
  if (correct) {
    score++;
    scoreText.textContent = score;
    selected.classList.add("correct");
  } else {
    selected.classList.add("wrong");
  }
  Array.from(answerButtons.children).forEach(btn => {
    if (btn.dataset.correct === "true") btn.classList.add("correct");
    btn.disabled = true;
  });
  nextBtn.style.display = "block";
}

nextBtn.addEventListener("click", () => {
  currentQuestionIndex++;
  if (currentQuestionIndex < questions.length) showQuestion();
  else endQuiz();
});

function endQuiz(timeUp = false) {
  clearInterval(timerInterval);
  quizContainer.classList.add("d-none");
  resultScreen.classList.remove("d-none");
  if (timeUp)
    finalScore.textContent = `⏰ Time’s up! You scored ${score} out of ${questions.length}.`;
  else
    finalScore.textContent = `You scored ${score} out of ${questions.length}!`;
}

restartBtn.addEventListener("click", () => {
  resultScreen.classList.add("d-none");
  startScreen.classList.remove("d-none");
});

</script>

{% endblock scripts %}